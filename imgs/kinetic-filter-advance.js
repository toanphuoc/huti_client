;(function(){var ABSOLUTE_OPACITY='absoluteOpacity',ABSOLUTE_TRANSFORM='absoluteTransform',ADD='add',B='b',BEFORE='before',BLACK='black',CHANGE='Change',CHILDREN='children',DEG='Deg',DOT='.',EMPTY_STRING='',G='g',GET='get',HASH='#',ID='id',KINETIC='kinetic',LISTENING='listening',MOUSEENTER='mouseenter',MOUSELEAVE='mouseleave',NAME='name',OFF='off',ON='on',PRIVATE_GET='_get',R='r',RGB='RGB',SET='set',SHAPE='Shape',SPACE=' ',STAGE='Stage',TRANSFORM='transform',UPPER_B='B',UPPER_G='G',UPPER_HEIGHT='Height',UPPER_R='R',UPPER_WIDTH='Width',UPPER_X='X',UPPER_Y='Y',VISIBLE='visible',X='x',Y='y';Kinetic.Factory={addGetterSetter:function(constructor,attr,def,validator,after){this.addGetter(constructor,attr,def);this.addSetter(constructor,attr,validator,after);this.addOverloadedGetterSetter(constructor,attr);},addGetter:function(constructor,attr,def){var method=GET+ Kinetic.Util._capitalize(attr);constructor.prototype[method]=function(){var val=this.attrs[attr];return val===undefined?def:val;};},addSetter:function(constructor,attr,validator,after){var method=SET+ Kinetic.Util._capitalize(attr);constructor.prototype[method]=function(val){if(validator){val=validator.call(this,val);}
this._setAttr(attr,val);if(after){after.call(this);}
return this;};},addComponentsGetterSetter:function(constructor,attr,components,validator,after){var len=components.length,capitalize=Kinetic.Util._capitalize,getter=GET+ capitalize(attr),setter=SET+ capitalize(attr),n,component;constructor.prototype[getter]=function(){var ret={};for(n=0;n<len;n++){component=components[n];ret[component]=this.getAttr(attr+ capitalize(component));}
return ret;};constructor.prototype[setter]=function(val){var oldVal=this.attrs[attr],key;if(validator){val=validator.call(this,val);}
for(key in val){this._setAttr(attr+ capitalize(key),val[key]);}
this._fireChangeEvent(attr,oldVal,val);if(after){after.call(this);}
return this;};this.addOverloadedGetterSetter(constructor,attr);},addOverloadedGetterSetter:function(constructor,attr){var capitalizedAttr=Kinetic.Util._capitalize(attr),setter=SET+ capitalizedAttr,getter=GET+ capitalizedAttr;constructor.prototype[attr]=function(){if(arguments.length){this[setter](arguments[0]);return this;}
else{return this[getter]();}};},backCompat:function(constructor,methods){var key;for(key in methods){constructor.prototype[key]=constructor.prototype[methods[key]];}},afterSetFilter:function(){this._filterUpToDate=false;}};Kinetic.Validators={RGBComponent:function(val){if(val>255){return 255;}
else if(val<0){return 0;}
else{return Math.round(val);}},alphaComponent:function(val){if(val>1){return 1;}
else if(val<0.0001){return 0.0001;}
else{return val;}}};})();;(function(){Kinetic.Filters.RGB=function(imageData){var data=imageData.data,nPixels=data.length,red=this.attrs.red,green=this.attrs.green,blue=this.attrs.blue,i,brightness;for(i=0;i<nPixels;i+=4){brightness=(0.34*data[i]+ 0.5*data[i+ 1]+ 0.16*data[i+ 2])/255;
data[i]=brightness*red;data[i+ 1]=brightness*green;data[i+ 2]=brightness*blue;data[i+ 3]=data[i+ 3];}};Kinetic.Factory.addGetterSetter(Kinetic.Node,'red',0,function(val){this._filterUpToDate=false;if(val>255){return 255;}
else if(val<0){return 0;}
else{return Math.round(val);}});Kinetic.Factory.addGetterSetter(Kinetic.Node,'green',0,function(val){this._filterUpToDate=false;if(val>255){return 255;}
else if(val<0){return 0;}
else{return Math.round(val);}});Kinetic.Factory.addGetterSetter(Kinetic.Node,'blue',0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter);})();;(function(){Kinetic.Filters.HSV=function(imageData){var data=imageData.data,nPixels=data.length,v=Math.pow(2,this.attrs.value),s=Math.pow(2,this.attrs.saturation),h=Math.abs((this.attrs.hue)+ 360)%360,i;var vsu=v*s*Math.cos(h*Math.PI/180),vsw=v*s*Math.sin(h*Math.PI/180);var rr=0.299*v+0.701*vsu+0.167*vsw,rg=0.587*v-0.587*vsu+0.330*vsw,rb=0.114*v-0.114*vsu-0.497*vsw;var gr=0.299*v-0.299*vsu-0.328*vsw,gg=0.587*v+0.413*vsu+0.035*vsw,gb=0.114*v-0.114*vsu+0.293*vsw;var br=0.299*v-0.300*vsu+1.250*vsw,bg=0.587*v-0.586*vsu-1.050*vsw,bb=0.114*v+0.886*vsu-0.200*vsw;var r,g,b,a;for(i=0;i<nPixels;i+=4){r=data[i+0];g=data[i+1];b=data[i+2];a=data[i+3];data[i+0]=rr*r+ rg*g+ rb*b;data[i+1]=gr*r+ gg*g+ gb*b;data[i+2]=br*r+ bg*g+ bb*b;data[i+3]=a;}};Kinetic.Factory.addGetterSetter(Kinetic.Node,'hue',0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,'saturation',0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,'value',0,null,Kinetic.Factory.afterSetFilter);})();;(function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,'hue',0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,'saturation',0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,'luminance',0,null,Kinetic.Factory.afterSetFilter);Kinetic.Filters.HSL=function(imageData){var data=imageData.data,nPixels=data.length,v=1,s=Math.pow(2,this.attrs.saturation),h=Math.abs((this.attrs.hue)+ 360)%360,l=this.attrs.luminance*127,i;var vsu=v*s*Math.cos(h*Math.PI/180),vsw=v*s*Math.sin(h*Math.PI/180);var rr=0.299*v+0.701*vsu+0.167*vsw,rg=0.587*v-0.587*vsu+0.330*vsw,rb=0.114*v-0.114*vsu-0.497*vsw;var gr=0.299*v-0.299*vsu-0.328*vsw,gg=0.587*v+0.413*vsu+0.035*vsw,gb=0.114*v-0.114*vsu+0.293*vsw;var br=0.299*v-0.300*vsu+1.250*vsw,bg=0.587*v-0.586*vsu-1.050*vsw,bb=0.114*v+0.886*vsu-0.200*vsw;var r,g,b,a;for(i=0;i<nPixels;i+=4){r=data[i+0];g=data[i+1];b=data[i+2];a=data[i+3];data[i+0]=rr*r+ rg*g+ rb*b+ l;data[i+1]=gr*r+ gg*g+ gb*b+ l;data[i+2]=br*r+ bg*g+ bb*b+ l;data[i+3]=a;}};})();;(function(){Kinetic.Filters.Noise=function(imageData){var amount=this.attrs.noise*255,data=imageData.data,nPixels=data.length,half=amount/2,i;for(i=0;i<nPixels;i+=4){data[i+ 0]+=half- 2*half*Math.random();data[i+ 1]+=half- 2*half*Math.random();data[i+ 2]+=half- 2*half*Math.random();}};Kinetic.Factory.addGetterSetter(Kinetic.Node,'noise',0.2,null,Kinetic.Factory.afterSetFilter);})();;(function(){function remap(fromValue,fromMin,fromMax,toMin,toMax){var fromRange=fromMax- fromMin,toRange=toMax- toMin,toValue;if(fromRange===0){return toMin+ toRange/2;}
if(toRange===0){return toMin;}
toValue=(fromValue- fromMin)/ fromRange;
toValue=(toRange*toValue)+ toMin;return toValue;}
Kinetic.Filters.Enhance=function(imageData){var data=imageData.data,nSubPixels=data.length,rMin=data[0],rMax=rMin,r,gMin=data[1],gMax=gMin,g,bMin=data[2],bMax=bMin,b,aMin=data[3],aMax=aMin,i;var enhanceAmount=this.attrs.enhance;if(enhanceAmount===0){return;}
for(i=0;i<nSubPixels;i+=4){r=data[i+ 0];if(r<rMin){rMin=r;}
else if(r>rMax){rMax=r;}
g=data[i+ 1];if(g<gMin){gMin=g;}else
if(g>gMax){gMax=g;}
b=data[i+ 2];if(b<bMin){bMin=b;}else
if(b>bMax){bMax=b;}}
if(rMax===rMin){rMax=255;rMin=0;}
if(gMax===gMin){gMax=255;gMin=0;}
if(bMax===bMin){bMax=255;bMin=0;}
if(aMax===aMin){aMax=255;aMin=0;}
var rMid,rGoalMax,rGoalMin,gMid,gGoalMax,gGoalMin,bMid,bGoalMax,aGoalMin,aMid,aGoalMax,bGoalMin;if(enhanceAmount>0){rGoalMax=rMax+ enhanceAmount*(255-rMax);rGoalMin=rMin- enhanceAmount*(rMin-0);gGoalMax=gMax+ enhanceAmount*(255-gMax);gGoalMin=gMin- enhanceAmount*(gMin-0);bGoalMax=bMax+ enhanceAmount*(255-bMax);bGoalMin=bMin- enhanceAmount*(bMin-0);aGoalMax=aMax+ enhanceAmount*(255-aMax);aGoalMin=aMin- enhanceAmount*(aMin-0);}else{rMid=(rMax+ rMin)*0.5;rGoalMax=rMax+ enhanceAmount*(rMax-rMid);rGoalMin=rMin+ enhanceAmount*(rMin-rMid);gMid=(gMax+ gMin)*0.5;gGoalMax=gMax+ enhanceAmount*(gMax-gMid);gGoalMin=gMin+ enhanceAmount*(gMin-gMid);bMid=(bMax+ bMin)*0.5;bGoalMax=bMax+ enhanceAmount*(bMax-bMid);bGoalMin=bMin+ enhanceAmount*(bMin-bMid);aMid=(aMax+ aMin)*0.5;aGoalMax=aMax+ enhanceAmount*(aMax-aMid);aGoalMin=aMin+ enhanceAmount*(aMin-aMid);}
for(i=0;i<nSubPixels;i+=4){data[i+ 0]=remap(data[i+ 0],rMin,rMax,rGoalMin,rGoalMax);data[i+ 1]=remap(data[i+ 1],gMin,gMax,gGoalMin,gGoalMax);data[i+ 2]=remap(data[i+ 2],bMin,bMax,bGoalMin,bGoalMax);}};Kinetic.Factory.addGetterSetter(Kinetic.Node,'enhance',0,null,Kinetic.Factory.afterSetFilter);})();;(function(){Kinetic.Filters.Pixelate=function(imageData){var pixelSize=Math.ceil(this.attrs.pixelSize),width=imageData.width,height=imageData.height,x,y,i,red,green,blue,alpha,nBinsX=Math.ceil(width/pixelSize),nBinsY=Math.ceil(height/pixelSize),xBinStart,xBinEnd,yBinStart,yBinEnd,xBin,yBin,pixelsInBin;imageData=imageData.data;for(xBin=0;xBin<nBinsX;xBin+=1){for(yBin=0;yBin<nBinsY;yBin+=1){red=0;green=0;blue=0;alpha=0;xBinStart=xBin*pixelSize;xBinEnd=xBinStart+ pixelSize;yBinStart=yBin*pixelSize;yBinEnd=yBinStart+ pixelSize;pixelsInBin=0;for(x=xBinStart;x<xBinEnd;x+=1){if(x>=width){continue;}
for(y=yBinStart;y<yBinEnd;y+=1){if(y>=height){continue;}
i=(width*y+ x)*4;red+=imageData[i+ 0];green+=imageData[i+ 1];blue+=imageData[i+ 2];alpha+=imageData[i+ 3];pixelsInBin+=1;}}
red=red/pixelsInBin;green=green/pixelsInBin;blue=blue/pixelsInBin;for(x=xBinStart;x<xBinEnd;x+=1){if(x>=width){continue;}
for(y=yBinStart;y<yBinEnd;y+=1){if(y>=height){continue;}
i=(width*y+ x)*4;imageData[i+ 0]=red;imageData[i+ 1]=green;imageData[i+ 2]=blue;imageData[i+ 3]=alpha;}}}}};Kinetic.Factory.addGetterSetter(Kinetic.Node,'pixelSize',8,null,Kinetic.Factory.afterSetFilter);})();;(function(){Kinetic.Filters.Posterize=function(imageData){var levels=Math.round(this.attrs.levels*254)+ 1,data=imageData.data,len=data.length,scale=(255/levels),i;for(i=0;i<len;i+=1){data[i]=Math.floor(data[i]/scale)*scale;}};Kinetic.Factory.addGetterSetter(Kinetic.Node,'levels',0.5,null,Kinetic.Factory.afterSetFilter);})();;(function(){Kinetic.Filters.Threshold=function(imageData){var level=this.attrs.threshold*255,data=imageData.data,len=data.length,i;for(i=0;i<len;i+=1){data[i]=data[i]<level?0:255;}};Kinetic.Factory.addGetterSetter(Kinetic.Node,'threshold',0.5,null,Kinetic.Factory.afterSetFilter);})();;(function(){Kinetic.Filters.Sepia=function(imageData){var data=imageData.data,w=imageData.width,y=imageData.height,w4=w*4,offsetY,x,offset,or,og,ob,r,g,b;do{offsetY=(y-1)*w4;x=w;do{offset=offsetY+(x-1)*4;or=data[offset];og=data[offset+1];ob=data[offset+2];r=or*0.393+ og*0.769+ ob*0.189;g=or*0.349+ og*0.686+ ob*0.168;b=or*0.272+ og*0.534+ ob*0.131;data[offset]=r>255?255:r;data[offset+1]=g>255?255:g;data[offset+2]=b>255?255:b;data[offset+3]=data[offset+3];}while(--x);}while(--y);};})();;(function(){Kinetic.Filters.Solarize=function(imageData){var data=imageData.data,w=imageData.width,h=imageData.height,w4=w*4,y=h;do{var offsetY=(y-1)*w4;var x=w;do{var offset=offsetY+(x-1)*4;var r=data[offset];var g=data[offset+1];var b=data[offset+2];if(r>127){r=255- r;}
if(g>127){g=255- g;}
if(b>127){b=255- b;}
data[offset]=r;data[offset+1]=g;data[offset+2]=b;}while(--x);}while(--y);};})();